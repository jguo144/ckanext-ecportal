<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:foaf="http://xmlns.com/foaf/0.1/"
  xmlns:owl="http://www.w3.org/2002/07/owl#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:dc="http://purl.org/dc/terms/"
  xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
  xmlns:dcat="http://www.w3.org/ns/dcat#"
  typeof="dcat:Dataset"
  about=""
  py:strip="">

  <xi:include href="../_snippet/data-api-help.html" />
  <xi:include href="../snippets/data-viewer-embed-dialog.html" />

  <py:def function="optional_head">
    <!-- data preview -->
    <link rel="stylesheet" href="${h.url_for_static('/scripts/vendor/leaflet/0.3.1/leaflet.css')}" />
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="${h.url_for_static('/scripts/vendor/leaflet/0.3.1/leaflet.ie.css')}" />
    <![endif]-->
    <link rel="stylesheet" href="${h.url_for_static('/scripts/vendor/recline/css/data-explorer.css')}" />
    <link rel="stylesheet" href="${h.url_for_static('/scripts/vendor/recline/css/graph.css')}" />
    <link rel="stylesheet" href="${h.url_for_static('/scripts/vendor/recline/css/map.css')}" />
    <link rel="stylesheet" href="${h.url_for_static('/scripts/vendor/recline/css/grid.css')}" />
    <style type="text/css">
      .recline-query-editor form, .recline-query-editor .text-query {
        height: 28px;
      }

      .recline-query-editor .pagination ul {
        margin: 0;
        padding: 0;
      }

      /* needed for Chrome but not FF */
      .header .recline-query-editor .add-on {
        margin-left: -27px;
      }

      /* needed for FF but not chrome */
      .header .recline-query-editor .input-prepend {
        vertical-align: top;
      }
    </style>
    <!-- /data preview -->
    <style type="text/css">
      .resource-actions {
        margin-right: 0;
      }
      .resource-actions .btn {
        position: relative;
        bottom: 3px;
        padding: 8px 10px;
      }
      .resource-actions .download {
        display: inline;
      }
      .resource-actions .download img {
        margin: 0px 4px -4px 0;
      }
      .preview-header {
        padding-bottom: 13px;
        padding-top: 0px;
      }
      .preview-header h3 {
        display: inline;
      }
      .preview-header .btn {
        float: right;
        position: relative;
        bottom: 6px;
        padding: 8px 15px;
      }
    </style>
    <script type="text/javascript">
      var preload_resource = ${h.literal(c.resource_json)};
      var embedPath = "${g.site_url+h.url_for(controller='package', action='resource_embedded_dataviewer', id=c.package.id, resource_id=c.resource.id)}";
    </script>
  </py:def>

  <py:def function="page_title">
    ${h.dataset_display_name(c.package)} /
    ${h.resource_display_name(c.resource)} - ${_('Dataset - Resource')}
  </py:def>

  <py:def function="page_heading">${h.dataset_display_name(c.package)}</py:def>

  <py:def function="breadcrumbs_extra">
    <span class="seperator">&gt;</span>
    <a href="${h.url_for(controller='group', action='index')}">${_('Publisher')}</a>
    <span class="seperator">&gt;</span>
    <span py:for="group in sorted(c.pkg_dict.groups, key=lambda g: g['title'] or g['name'])">
      <a href="${h.url_for(controller='group', action='read', id=group['name'])}">${h.truncate(group.get('title') or group.get('name'), length=35)}</a>
      <span class="seperator">&gt;</span>
    </span>
    <a href="${h.url_for(controller='package', action='read', id=c.pkg_dict.name)}">${h.truncate(c.pkg_dict.title or c.pkg_dict.name, length=35)}</a>
    <span class="seperator">&gt;</span>
    <a href="">${h.truncate(h.resource_display_name(c.resource), length=35)}</a>
  </py:def>

  <py:match path="primarysidebar">

    <li py:if="c.pkg_dict.get('license_id')" id="dataset-license" class="sidebar-section">
      <strong>Licence:</strong>
        <py:choose test="">
          <span py:when="c.pkg.license and c.pkg.license.url"><a
              href="${c.pkg.license.url}" rel="dc:rights">${c.pkg.license.title.split('::')[-1]}</a></span>
          <span py:when="c.pkg.license" property="dc:rights">${c.pkg.license.title}</span>
          <span py:when="c.pkg.license_id" property="dc:rights">${c.pkg.license_id}</span>
          <span py:when="not(c.pkg.license)">${_('License unknown')}</span>
        </py:choose>
    </li>

  </py:match>
  

  <div py:match="content">

    <div class="package-box">
      <h3 class="alt">
        <i class="resource"></i>
        ${h.resource_display_name(c.resource)}
      </h3>
      <div class="inner faded resource-actions">
        <a py:if="c.resource.get('url')" class="button button-primary resource-url-analytics resource-type-${c.resource.get('resource_type')}" href="${c.resource.get('url')}">${_('Download')}</a>
      </div>
    </div>

  <py:if test="config.get('ckan.datastore.enabled', False)">
    ${data_api_help(c.datastore_api)}
  </py:if>

  ${data_viewer_embed_dialog()}

    <div class="package-box" property="rdfs:label">
      <h3><i class="note"></i> ${_('Description')}</h3>
      <div class="inner faded">
        ${c.resource.get('description') or _('(No description)')}
      </div>
    </div>

    <div class="package-box">
      <h3><i class="format"></i> ${_('Format')}</h3>
      <div class="inner faded">
        ${c.resource['format'] or 'Unknown'}
      </div>
    </div>

    <div py:if="not c.resource.get('description') and c.package.get('notes')" id="dataset-description">
      <div>
        <strong>
          ${_('From')}: <a href="${h.url_for(controller='package', action='read', id=c.package['name'])}">${ c.package.get('title') or c.package.get('name') }</a>:
        </strong>
      </div>
      <div>${h.markdown_extract(c.package.get('notes'), 300)}</div>
    </div>

    <div class="resource-preview">
      <div class="preview-header">
        <h3>${_('Preview')}</h3>
        <a py:if="c.pkg.is_private" title="Cannot embed as resource is private." style="display: none;" class="btn disabled" data-toggle="modal" href=".modal-data-viewer-embed-dialog">${_('Embed')}</a>
        <a py:if="not c.pkg.is_private" style="display: none;" class="btn btn-primary" data-toggle="modal" href=".modal-data-viewer-embed-dialog">${_('Embed')}</a>
      </div>
      <div id="ckanext-datapreview"></div>
    </div>

    <div class="package-box resource-information">
      <h3>
        <i class="info"></i>
        ${_('Additional Information')}
      </h3>
      <div class="inner">
        <div id="less-meta" class="quick-info">
          <dl>
            <dt property="rdfs:label">${_('URL')}</dt>
            <dd property="rdf:value"><a href="${c.resource['url']}">${c.resource['url']}</a></dd>
          </dl>
          <dl py:if="c.resource.get('release_date')">
            <dt>${_('Release Date')}</dt>
            <dd>${c.pkg_dict['release_date']}</dd>
          </dl>
          <dl py:if="c.resource.get('modified_date')">
            <dt>${_('Modified Date')}</dt>
            <dd>${c.pkg_dict['modified_date']}</dd>
          </dl>
          <dl py:if="c.resource.get('name')">
            <dt>${_('Name')}</dt>
            <dd>${c.pkg_dict['name']}</dd>
          </dl>
          <dl py:if="c.resource.get('size')">
            <dt>${_('Size')}</dt>
            <dd>${c.resource['size']}</dd>
          </dl>
          <dl py:if="c.resource.get('status')">
            <dt>${_('Status')}</dt>
            <dd>${c.resource['status']}</dd>
          </dl>
          <p class="more-meta"><a href="#more-meta">${_('More Additional Information')}</a></p>
        </div>
        <div id="more-meta" class="quick-info" style="display:none;">
          <py:for each="i, key in enumerate(sorted(c.resource.keys()))">
            <dl py:if="not key in ('description', 'url', 'status', 'size', 'release_date', 'modified_date')">
              <dt property="rdfs:label">${_(key)}</dt>
              <dd property="rdf:value">${c.resource[key]}</dd>
            </dl>
          </py:for>
          <p class="less-meta"><a href="#less-meta">${_('Less Additional Information')}</a></p>
        </div>
      </div>
    </div>

    <div class="package-box"><div class="inner">
      <a href="${h.url_for(controller='package', action='read', id=c.package['name'])}">
        <i class="icon-back"></i> ${_('Back to dataset')}
      </a>
    </div></div>

    <span class="insert-comment-thread"></span>
  </div>

  <py:def function="optional_footer">
    <!-- data preview -->
    <script type="text/javascript" src="${h.url_for_static('/scripts/vendor/jquery.mustache/jquery.mustache.js')}"></script>
    <script type="text/javascript" src="${h.url_for_static('/scripts/vendor/flot/0.7/jquery.flot.js')}"></script>
    <script type="text/javascript" src="${h.url_for_static('/scripts/vendor/flot/0.7/jquery.flot.js')}"></script>
    <script type="text/javascript" src="${h.url_for_static('/scripts/vendor/leaflet/0.3.1/leaflet.js')}"></script>
    <script src="${h.url_for_static('/scripts/vendor/recline/recline.js')}"></script>
  </py:def>

  <xi:include href="layout.html" />
</html>
