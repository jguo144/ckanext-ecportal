<form id="dataset-edit" method="post"
  py:attrs="{'class':'has-errors'} if errors else {}"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude">

<div class="error-explanation" py:if="error_summary">
<h2>Errors in form</h2>
<p>The form contains invalid entries:</p>
<ul>
  <li py:for="key, error in error_summary.items()">${"%s: %s" % (key, error)}
    <py:if test="key=='Resources'">
      <ul>
        <py:for each="idx, errordict in enumerate(errors.get('resources', []))">
          <li py:if="errordict">
            Resource ${idx}:
            <ul>
              <li py:for="thiskey, thiserror in errordict.items()">${thiskey}: <py:for each="errorinfo in thiserror">${errorinfo}; </py:for></li>
            </ul>
          </li>
        </py:for>
      </ul>
    </py:if>
  </li>
</ul>
</div>

<fieldset id="basic-information">
  <dl>
    <dt class="title-label"><label class="field_opt" for="title">Title</label></dt>
    <dd class="title-field">
      <input id="title"
        class="js-title"
        name="title" type="text"
        value="${data.get('title', '')}"
        placeholder="${_('A short descriptive title for the dataset')}"
      />
    </dd>
    <dd class="instructions basic">A short descriptive title for the data set.
    It should not be a description though - save that for the Description field.
    Do not give a trailing full stop. Do not use allcaps.</dd>
    <dd class="title-instructions field_error" py:if="errors.get('title', '')">${errors.get('title', '')}</dd>

    <dt class="name-label"><label class="field_req" for="name">Name</label></dt>
    <dd class="name-field">
      <span class="js-url-text url-text">
        <span class="js-url-viewmode js-url-suffix">&nbsp;</span>
        (${g.site_url + h.url(controller='package', action='search')+'/'}<span class="js-url-viewmode js-url-suffix">&nbsp;</span>)
        <a href="#" style="display: none;" class="url-edit js-url-editlink js-url-viewmode">(edit)</a>
      </span>
      <input style="display: none;" id="name" maxlength="100" name="name" type="text"
             class="url-input js-url-editmode js-url-input" value="${data.get('name', '')}" />
      <p class="js-url-is-valid">&nbsp;</p>
    </dd>
    <dd style="display: none;" class="js-url-editmode name-instructions basic">
      A unique identifier for the package. It should be broadly humanly readable, in the spirit of Semantic Web URIs.
      Only use an acronym if it is widely recognised. Renaming is possible but discouraged.
      2+ characters, lowercase, using only 'a-z0-9' and '-_' include date (yyyy-mm-dd) if a static dataset.
    </dd>
    <dd class="js-url-editmode name-instructions field_error" py:if="errors.get('name', '')">${errors.get('name', '')}</dd>

    <dt class="description-label"><label class="field_req" for="notes">Description</label></dt>
    <dd class="description-field"><div class="markdown-editor">
      <ul class="button-row">
        <li><button class="pretty-button js-markdown-edit depressed">Edit</button></li>
        <li><button class="pretty-button js-markdown-preview">Preview</button></li>
      </ul>
      <textarea class="markdown-input" name="notes" id="notes" placeholder="${_('Start with a summary sentence ...')}">${data.get('notes','')}</textarea>
      <div class="markdown-preview" style="display: none;"></div>
      <span class="hints">You can use <a href="http://daringfireball.net/projects/markdown/syntax" target="_blank">Markdown formatting</a> here.</span>
    </div></dd>
    <dd class="instructions basic">
    The main description of the dataset.  It is often displayed with the package title.
    In particular, it should start with a short sentence that describes the data set succinctly,
    because the first few words alone may be used in some views of the data sets.</dd>

    <dt class="homepage-label"><label class="field_opt" for="url">URL</label></dt>
    <dd class="homepage-field"><input id="url" name="url" type="text" value="${data.get('url', '')}"/></dd>
    <dd class="homepage-instructions instructions basic">The URL for the web page describing the data (not the data itself).</dd>
    <dd class="homepage-instructions hints">e.g. http://www.example.com/growth-figures.html</dd>
    <dd class="homepage-instructions field_error" py:if="errors.get('url', '')">${errors.get('url', '')}</dd>

    <dt class="license-label"><label class="field_opt" for="license_id">License</label></dt>
    <dd class="license-field">
      <select id="license_id" name="license_id">
        <py:for each="licence_desc, licence_id in c.licences">
          <option value="${licence_id}" py:attrs="{'selected': 'selected' if data.get('license_id', '') == licence_id else None}" >${licence_desc}</option>
        </py:for>
      </select>
    </dd>
    <dd class="license-instructions instructions basic">The licence under which the dataset is released.</dd>

    <dt class="publisher-label"><label class="field_opt" for="published_by">Published By</label></dt>
    <dd class="publisher-field">
      <select id="published_by" name="published_by">
        <py:for each="publisher_desc, publisher_id in c.publishers">
          <option value="${publisher_id}" py:attrs="{'selected': 'selected' if data.get('published_by', '') == publisher_id else None}" >${publisher_desc}</option>
        </py:for>
      </select>
    </dd>
    <dd class="instructions basic">The publisher of the dataset.</dd>
    <dd class="field_error" py:if="errors.get('published_by', '')">${errors.get('published_by', '')}</dd>
  </dl>
</fieldset>

<fieldset id='further-information'>
  <dl>
    <dt><label class="field_opt" for="type_of_dataset">Type of Dataset</label></dt>
    <dd>
      <select class="short" id="type_of_dataset" name="type_of_dataset">
        <py:for each="name, desc in c.type_of_dataset">
          <option value="${name}" py:attrs="{'selected': 'selected' if data.get('type_of_dataset', '') == name else None}" >
            ${desc}
          </option>
        </py:for>
      </select>
    </dd>
    <dd class="instructions basic">The type of dataset.</dd>
    <dd class="instructions further">
    <p>Primary legal materials include documents of primary authority issued by governmental bodies, such as court opinions,
    statutes, and regulations. They also include the supporting documents and other media issued and maintained by those bodies,
    such as dockets, hearings, forms, oral arguments, and legislative histories. These materials can be found in every branch,
    at every level, national, tribal, state and local, and should be available to anyone with the will and the heart to obtain them.</p>
    <p>Government operational records are typically administrative records (rather than legal records) that are useful for the
    public to identify conflicts of interest and to perform oversight. Contracts/grants, personal financial disclosures, etc.
    These documents have little utility aside from oversight.</p>
    <p>The last category "civic capital" are government records that have utility that have nothing to do with government per se.
    Environmental and weather data, health and safety data, corporate compliance records. These records can save lives,
    make markets more efficient, etc. These records are closest to Government as a Platform.</p>
    </dd>
    <dd class="field_error" py:if="errors.get('type_of_dataset', '')">${errors.get('type_of_dataset', '')}</dd>

    <dt><label class="field_opt" for="release_date">Release Date</label></dt>
    <dd><input id="release_date" name="release_date" size="40" type="text" value="${data.get('release_date', '')}" /></dd>
    <dd class="instructions basic">Date of formal issuance (e.g., publication) of the dataset.</dd>
    <dd class="hints">Acceptable date formats: YYYY-MM-DD, YYYY-MM, YYYY</dd>
    <dd class="field_error" py:if="errors.get('release_date', '')">${errors.get('release_date', '')}</dd>

    <dt><label class="field_opt" for="modified_date">Modified Date</label></dt>
    <dd><input id="modified_date" name="modified_date" size="40" type="text" value="${data.get('modified_date', '')}"/></dd>
    <dd class="instructions basic">Most recent date on which the dataset was changed, updated or modified.</dd>
    <dd class="hints">Acceptable date formats: YYYY-MM-DD, YYYY-MM, YYYY</dd>
    <dd class="field_error" py:if="errors.get('modified_date', '')">${errors.get('modified_date', '')}</dd>

    <dt><label class="field_opt" for="update_frequency">Update Frequency</label></dt>
    <dd>
      <select class="short" id="update_frequency" name="update_frequency">
        <py:for each="freq_name, freq_desc in c.update_frequency">
          <option value="${freq_name}" py:attrs="{'selected': 'selected' if data.get('update_frequency', '') == freq_name else None}" >
            ${freq_desc}
          </option>
        </py:for>
      </select>
      <label class="inline" for="update_frequency-other">Other:
        <input class="medium-width" id="update_frequency-other" name="update_frequency-other" type="text" value="${data.get('update_frequency-other', '')}"/>
      </label>
    </dd>
    <dd class="instructions basic">The frequency with which dataset is published.</dd>
    <dd class="field_error" py:if="errors.get('update_frequency', '')">${errors.get('update_frequency', '')}</dd>

    <dt><label class="field_opt" for="temporal_coverage">Temporal Coverage</label></dt>
    <dd>
      <input class="medium-width" id="temporal_coverage_from" name="temporal_coverage_from" type="text" value="${data.get('temporal_coverage_from', '')}" /> -
      <input class="medium-width" id="temporal_coverage_to" name="temporal_coverage_to" type="text" value="${data.get('temporal_coverage_to', '')}" />
    </dd>
    <dd class="instructions basic">The start and end of the temporal series used in this dataset.</dd>
    <dd class="hints">e.g. 2010-01-01 - 2012-01-01</dd>
    <dd class="hints">Acceptable date formats: YYYY-MM-DD, YYYY-MM, YYYY</dd>

    <dt><label class="field_opt" for="temporal_granularity">Temporal Granularity</label></dt>
    <dd>
      <select class="short" id="temporal_granularity" name="temporal_granularity">
        <py:for each="temporal_name, temporal_desc in c.temporal_granularity">
          <option value="${temporal_name}" py:attrs="{'selected': 'selected' if data.get('temporal_granularity', '') == temporal_name else None}" >
            ${temporal_name}
          </option>
        </py:for>
      </select>
    </dd>
    <dd class="instructions basic">This should give the lowest level of temporal detail given in the dataset
    if it is aggregated, expressed as an interval of time.
    </dd>

    <dt><label class="field_opt" for="geographical_coverage">Geographical Coverage</label></dt>
    <dd class="tags-field">
      <select id="geographical_coverage" class="chzn-select" name="geographical_coverage" multiple="multiple" style="width: 30em;">
        <py:for each="tag_name, tag_translation in c.geographical_coverage">
          <py:choose test="">
          <option py:when="tag_name in data.get('geographical_coverage', [])" selected="selected" value="${tag_name}">${tag_translation}</option>
          <option py:otherwise="" value="${tag_name}">${tag_translation}</option>
          </py:choose>
        </py:for>
      </select>
    </dd>
    <dd class="instructions basic">The geographical coverage of this dataset.</dd>
    <dd class="tags-instructions field_error" py:if="errors.get('geographical_coverage', '')">${errors.get('geographical_coverage', '')}</dd>

    <dt><label class="field_opt" for="version">Version</label></dt>
    <dd><input id="version" maxlength="100" name="version" type="text" value="${data.get('version', '')}" /></dd>
    <dd class="instructions basic">A number representing the version (if applicable)</dd>
    <dd class="hints">e.g. 1.2.0</dd>

  </dl>
</fieldset>

<fieldset id="resources">
  <div class="instructions basic"><h3>Resources: the files and APIs associated with this dataset</h3></div>
  <table class="resource-table-edit">
    <thead>
      <tr>
        <th class="field_req resource-url">Resource</th>
        <th class="resource-delete-link"></th>
      </tr>
    </thead>
    <tbody class="js-resource-editor">
    </tbody>
  </table>

  <div class="resource-add">
    <ul class="button-row">
      <li><h4>Add a resource:</h4></li>
      <li><button class="pretty-button js-link-file">Link to a file</button></li>
      <li><button class="pretty-button js-link-api">Link to an API</button></li>
      <li class="js-upload-file" style="display:none;"><button class="pretty-button js-upload-file">Upload a file</button></li>
    </ul>
  </div>
</fieldset>

<fieldset id="keywords">
  <dl>
    <dt class="tags-label"><label class="field_opt" for="tags">Keywords</label></dt>
    <dd class="tags-field">
      <input class="long autocomplete-tag" id="tag_string" name="tag_string" size="60" type="text"
               value="${data.get('tag_string') or ', '.join([tag['name'] for tag in data.get('tags', [])])}" />
    </dd>
    <dd class="tags-instructions instructions basic" i18n:msg="">Comma-separated terms that may link this dataset to similar ones. For more information on conventions, see <a href="http://wiki.okfn.org/ckan/doc/faq#TagConventions">this wiki page</a>.</dd>
    <dd class="instructions further">
      Keywords must be alphanumeric characters or symbols: -_.
      Keywords must not be uppercase words in phrases connected with hyphen.
    </dd>
    <dd class="hints">e.g. pollution rivers water-quality</dd>
    <dd class="tags-instructions field_error" py:if="errors.get('tag_string', '')">${errors.get('tag_string', '')}</dd>
  </dl>
</fieldset>

<fieldset id="notes">
  <dl>
    <dt><label class="field_opt" for="skos_note">SKOS Note</label></dt>
    <dd><input id="skos_note" name="skos_note" size="40" type="text" value="${data.get('skos_note', '')}" /></dd>
    <dd class="field_error" py:if="errors.get('skos_note', '')">${errors.get('skos_note', '')}</dd>

    <dt><label class="field_opt" for="change_note">Change Note</label></dt>
    <dd><input id="change_note" name="change_note" size="40" type="text" value="${data.get('change_note', '')}" /></dd>
    <dd class="field_error" py:if="errors.get('change_note', '')">${errors.get('change_note', '')}</dd>

    <dt><label class="field_opt" for="definition_note">Definition Note</label></dt>
    <dd><input id="definition_note" name="definition_note" size="40" type="text" value="${data.get('definition_note', '')}" /></dd>
    <dd class="field_error" py:if="errors.get('definition_note', '')">${errors.get('definition_note', '')}</dd>

    <dt><label class="field_opt" for="editorial_note">Editorial Note</label></dt>
    <dd><input id="editorial_note" name="editorial_note" size="40" type="text" value="${data.get('editorial_note', '')}" /></dd>
    <dd class="field_error" py:if="errors.get('editorial_note', '')">${errors.get('editorial_note', '')}</dd>

    <dt><label class="field_opt" for="history_note">History Note</label></dt>
    <dd><input id="history_note" name="history_note" size="40" type="text" value="${data.get('history_note', '')}" /></dd>
    <dd class="field_error" py:if="errors.get('history_note', '')">${errors.get('history_note', '')}</dd>

    <dt><label class="field_opt" for="scope_note">Scope Note</label></dt>
    <dd><input id="scope_note" name="scope_note" size="40" type="text" value="${data.get('scope_note', '')}" /></dd>
    <dd class="field_error" py:if="errors.get('scope_note', '')">${errors.get('scope_note', '')}</dd>

    <dt><label class="field_opt" for="example_note">Example Note</label></dt>
    <dd><input id="example_note" name="example_note" size="40" type="text" value="${data.get('example_note', '')}" /></dd>
    <dd class="field_error" py:if="errors.get('example_note', '')">${errors.get('example_note', '')}</dd>
  </dl>
</fieldset>

<fieldset id="extras">
  <h3>Extra Fields</h3>
  <dl py:if="c.additional_extras">
    <py:for each="num, extra in enumerate(c.additional_extras)">
    <dt><label for="extras__${num}__value">${extra.get('key')}</label></dt>
    <dd>
      <input id="extras__${num}__key" name="extras__${num}__key" type="hidden" value="${extra.get('key')}" />
      <input id="extras__${num}__value" name="extras__${num}__value" type="text" value="${extra.get('value')}" />
      <input type="checkbox" name="extras__${num}__deleted" checked="${extra.get('deleted')}"> Delete </input>
    </dd>
    </py:for>
  </dl>

  <dl>
    <py:for each="num in range(len(c.additional_extras), len(c.additional_extras) + 4)">
    <dt><label for="extras__${num}__key">New key</label></dt>
    <dd>
      <input class="medium-width" id="extras__${num}__key" name="extras__${num}__key" type="text" />
      with value
      <input class="medium-width" id="extras__${num}__value" name="extras__${num}__value" type="text" />
    </dd>
    </py:for>
  </dl>
</fieldset>

<fieldset id='delete' py:if="c.is_sysadmin or c.auth_for_change_state">
  <dl>
    <dt>Delete</dt>
    <dd>
      This dataset is&nbsp;&nbsp;
      <span>
      This dataset is&nbsp;&nbsp;
      <select id="state" class="dataset-delete" name="state" style="display:inline;">
        <option py:attrs="{'selected': 'selected' if data.get('state') == 'active' else None}" value="active">active</option>
        <option py:attrs="{'selected': 'selected' if data.get('state') == 'deleted' else None}" value="deleted">deleted</option>
      </select>
      </span>
    </dd>
  </dl>
</fieldset>

<div id="unsaved-warning"></div>

<div class="ckan-logged-in" style="display: none;">
  <p>Author: ${c.author}</p>
</div>
<div class="ckan-logged-out">
  <label>Author: ${c.author}</label>
  <p i18n:msg="" class="hints">
    Since you have not signed in this will just be your IP address.
    <a href="${h.url_for(controller='user', action='login', id=None)}" target="_blank">Click here to sign in</a> before saving (opens in new window).
  </p>
</div>

<div class="form-submit">
  <input id="save" class="pretty-button primary" name="save" type="submit" value="${_('Save Changes')}" />
  <py:if test="c.pkg">
    <input id="cancel" class="pretty-button href-action" name="cancel" type="reset" value="${_('Cancel')}" action="${h.url_for(controller='package', action='read', id=c.pkg.name)}" />
  </py:if>
  <p i18n:msg="" class="hints">
  <strong>Important:</strong> By submitting content, you agree to release your contributions under the <a href="http://opendatacommons.org/licenses/odbl/1.0/">Open Database License</a>. Please <strong>refrain</strong> from editing this page if you are <strong>not</strong> happy to do this.
  </p>
  <div class="clear"></div>
</div>

</form>
